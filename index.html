<!DOCTYPE html>
<html lang="en-US"><head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>

    <title>Error Handling Isn't All About Errors</title>

    <link href="dist/reset.css" rel="stylesheet"/>
    <link href="dist/reveal.css" rel="stylesheet"/>
    <link href="dist/theme/rustconf.css" id="theme" rel="stylesheet"/>
    <link href="plugin/highlight/rustconf.css" id="highlight-theme" rel="stylesheet"/>
    <script crossorigin="anonymous" src="https://kit.fontawesome.com/9144026ed3.js"></script>
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <section><div class="slide-wrapper">
<h1>Error Handling Isn't All About Errors</h1>
<p><span class="author">Jane Lusby</span></p>
<p><i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a></p>
<p>Slide Template by Rebecca Turner <i class="fa-twitter fab"></i> <a href="https://twitter.com/16kbps">@16kbps</a> / <a href="https://becca.ooo/">becca.ooo</a></p>
<aside class="notes"><p>Hello and welcome to my talk, error handling isn't all about errors.</p>
<div class="next-slide"><p>Next slide: Let me start by introducing myself…</p></div>

</aside></div></section>
<section class="center"><div class="slide-wrapper">
<h2>About Me</h2>
<aside class="notes"><p>My name is Jane Lusby, my pronouns are she/her. On the internet I go
by Yaah or Yaahc. I've been writing rust for two and a half years though I
was only recently hired to do so professionally, by The Zcash Foundation.</p>
<div class="next-slide"><p>Next slide: Quick shameless plug, I also maintain <code>awesome-rust-mentors</code>…</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Awesome Rust Mentors</h2>
<img alt="" src="img/mentors.png"/>
<aside class="notes"><p>Awesome-rust-mentors is a list of projects and people who are willing
to provide mentorship to anyone who asks. If you're interested in finding a
mentor, finding a project to get involved in, being a mentor, or getting
people involved in your project you should check it out.</p>
</aside></div></section>
<section><div class="slide-wrapper">
<h2>Why Error Handling?</h2>
<aside class="notes"><p>I actually got into error handling on accident, it started as a yak
shave when I wanted to open source a library I wrote for work but I wasn't
happy with the error handling so I decided to fix it up first.</p>
<div class="next-slide"><p>Next slide: That yak shave ended with me writing eyre…</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>eyre</h2>
<aside class="notes"><p>Eyre is a fork of anyhow with support for customized error reports via a
global hook, similar to a panic hook.</p>
<div class="next-slide"><p>Next slide: I also ended up writing color-eyre.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>color-eyre</h2>
<aside class="notes"><p>color-eyre is a library which provides a custom panic report hook and
a custom error report hook for eyre.</p>
<div class="next-slide"><p>Next slide: With these libraries I'm now able to construct error reports like
this.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> cargo run --example usage
<font color="#333333">Error:
   0: Unable to read config
   1: No such file or directory (os error 2)

  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ SPANTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━

   0: usage::read_file with path="fake_file"
      at examples/usage.rs:32
   1: usage::read_config
      at examples/usage.rs:38

Suggestion: try using a file that exists next time

Backtrace omitted.
Run with RUST_BACKTRACE=1 environment variable to display it.
Run with RUST_BACKTRACE=full to include source snippets.</font></pre>
<aside class="notes"><p>Here we can see the basic usage example.</p>
<div class="next-slide"><p>Next slide: In it we have an error section.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#333333"><b>❯</b> cargo run --example usage</font>
Error:
   0: <font color="#F15D22">Unable to read config</font>
   1: <font color="#F15D22">No such file or directory (os error 2)</font>
<font color="#333333">
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ SPANTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━

   0: usage::read_file with path="fake_file"
      at examples/usage.rs:32
   1: usage::read_config
      at examples/usage.rs:38

Suggestion: try using a file that exists next time

Backtrace omitted.
Run with RUST_BACKTRACE=1 environment variable to display it.
Run with RUST_BACKTRACE=full to include source snippets.</font></pre>
<aside class="notes"><div class="next-slide"><p>Next slide: followed by a span trace section...</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#333333"><b>❯</b> cargo run --example usage
Error:
   0: Unable to read config
   1: No such file or directory (os error 2)
</font>
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ SPANTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━

   0: <font color="#F15D22">usage::read_file</font> with <font color="#34E2E2">path="fake_file"</font>
      at <font color="#75507B">examples/usage.rs</font>:<font color="#75507B">32</font>
   1: <font color="#F15D22">usage::read_config</font>
      at <font color="#75507B">examples/usage.rs</font>:<font color="#75507B">38</font>
<font color="#333333">
Suggestion: try using a file that exists next time

Backtrace omitted.
Run with RUST_BACKTRACE=1 environment variable to display it.
Run with RUST_BACKTRACE=full to include source snippets.</font></pre>
<aside class="notes"><p>If you're not familiar with tracing is this extremely cool
backtrace-like type of tracing spans.</p>
<div class="next-slide"><p>Next slide: then after that we have a suggestion section</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#333333"><b>❯</b> cargo run --example usage
Error:
   0: Unable to read config
   1: No such file or directory (os error 2)

  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ SPANTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━

   0: usage::read_file with path="fake_file"
      at examples/usage.rs:32
   1: usage::read_config
      at examples/usage.rs:38
</font>
<font color="#34E2E2">Suggestion</font>: try using a file that exists next time
<font color="#333333">
Backtrace omitted.
Run with RUST_BACKTRACE=1 environment variable to display it.
Run with RUST_BACKTRACE=full to include source snippets.</font></pre>
<aside class="notes"><div class="next-slide"><p>Next slide: Followed finally by a omitted backtrace section</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#333333"><b>❯</b> cargo run --example usage
Error:
   0: Unable to read config
   1: No such file or directory (os error 2)

  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ SPANTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━

   0: usage::read_file with path="fake_file"
      at examples/usage.rs:32
   1: usage::read_config
      at examples/usage.rs:38

Suggestion: try using a file that exists next time
</font>
Backtrace omitted.
Run with RUST_BACKTRACE=1 environment variable to display it.
Run with RUST_BACKTRACE=full to include source snippets.</pre>
<aside class="notes"><div class="next-slide"><p>Next slide: I can also enable backtrace capture...</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><b>❯</b> RUST_BACKTRACE=1 <font color="#333333">cargo run --example usage
// ...
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━
                         ⋮ 5 frames hidden ⋮
   6: usage::read_file::h10b2389c2b814452
      at /home/jlusby/git/yaahc/color-eyre/examples/usage.rs:35
   7: usage::read_config::hf7150b146edb25d9
      at /home/jlusby/git/yaahc/color-eyre/examples/usage.rs:40
   8: usage::main::hc3df11a6ea0d044d
      at /home/jlusby/git/yaahc/color-eyre/examples/usage.rs:11
                        ⋮ 10 frames hidden ⋮
// ...
Run with RUST_BACKTRACE=full to include source snippets.</font></pre>
<aside class="notes"><div class="next-slide"><p>Next slide: Here we have a backtrace section...</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><b>❯</b> <font color="#333333">RUST_BACKTRACE=1 cargo run --example usage
// ...</font>
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━
  <font color="#34E2E2">                       ⋮ 5 frames hidden ⋮                       </font>
   6: <font color="#F15D22">usage::read_file</font><font color="#88807C">::h10b2389c2b814452</font>
      at <font color="#75507B">/home/jlusby/git/yaahc/color-eyre/examples/usage.rs</font>:<font color="#75507B">35</font>
   7: <font color="#F15D22">usage::read_config</font><font color="#88807C">::hf7150b146edb25d9</font>
      at <font color="#75507B">/home/jlusby/git/yaahc/color-eyre/examples/usage.rs</font>:<font color="#75507B">40</font>
   8: <font color="#F15D22">usage::main</font><font color="#88807C">::hc3df11a6ea0d044d</font>
      at <font color="#75507B">/home/jlusby/git/yaahc/color-eyre/examples/usage.rs</font>:<font color="#75507B">11</font>
  <font color="#34E2E2">                      ⋮ 10 frames hidden ⋮                       </font>
<font color="#333333">// ...
Run with RUST_BACKTRACE=full to include source snippets.</font></pre>
<aside class="notes"><p>We can control the formatting of the backtrace section, here you can
see a pretty printed backtrace based on <code>color-backtrace</code>, which hides
irrelevant frames, in this case it's hidden 5 frames before read_file and 10
frames after main.</p>
<div class="next-slide"><p>Next slide: we can also further customize this by applying custom filters…</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#333333"><b>❯</b> RUST_BACKTRACE=1 cargo run --example custom_filter
// ...</font>
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━
  <font color="#34E2E2">                       ⋮ 5 frames hidden ⋮                       </font>
   6: <font color="#F15D22">custom_filter::read_file</font><font color="#88807C">::h0afee8fe0960bf02</font>
      at <font color="#75507B">/home/jlusby/git/yaahc/color-eyre/examples/custom_filter.rs</font>:<font color="#75507B">53</font>
   7: <font color="#F15D22">custom_filter::read_config</font><font color="#88807C">::h6622065848c69b29</font>
      at <font color="#75507B">/home/jlusby/git/yaahc/color-eyre/examples/custom_filter.rs</font>:<font color="#75507B">58</font>
  <font color="#34E2E2">                      ⋮ 11 frames hidden ⋮                       </font>
<font color="#333333">// ...
Run with RUST_BACKTRACE=full to include source snippets.</font></pre>
<aside class="notes"><p>Here you can see we've got 11 frames hidden after read_config instead
of 10 frames hidden after main because I've configured it to hide the main
frame.</p>
<div class="next-slide"><p>Next slide: And we can apply this custom filtering consistently to all of our
errors.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> RUST_BACKTRACE=1 cargo run --example panic_hook --no-default-features
<font color="#CC0000">The application panicked (crashed).</font>
Message:  <font color="#06989A">No such file or directory (os error 2)</font>
Location: <font color="#75507B">examples/panic_hook.rs</font>:<font color="#75507B">37</font>

  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━
  <font color="#34E2E2">                      ⋮ 13 frames hidden ⋮                       </font>
  14: <font color="#F15D22">panic_hook::read_file</font><font color="#88807C">::h1a2c1d2710c16ca9</font>
      at <font color="#75507B">/home/jlusby/git/yaahc/color-eyre/examples/panic_hook.rs</font>:<font color="#75507B">37</font>
  15: <font color="#F15D22">panic_hook::read_config</font><font color="#88807C">::h2751dcca3305a9a3</font>
      at <font color="#75507B">/home/jlusby/git/yaahc/color-eyre/examples/panic_hook.rs</font>:<font color="#75507B">43</font>
  <font color="#34E2E2">                      ⋮ 11 frames hidden ⋮                       </font>

Run with COLORBT_SHOW_HIDDEN=1 environment variable to disable frame filtering.
Run with RUST_BACKTRACE=full to include source snippets.</pre>
<aside class="notes"><p>So here you can see we can have the same report format for panics as
we did for our errors.</p>
<div class="next-slide"><p>Next slide: with our error report hook we can also bundle arbitrary data with
our errors.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<pre class="term"><font color="#333333"><b>❯</b> cargo run --example custom_section
Error:
   0: the cat could not be got
   1: cmd exited unsuccessfully
</font>
Command:
   "git" "cat"

Stderr:
   git: 'cat' is not a git command. See 'git --help'.

   The most similar commands are
   	clean
   	mktag
   	stage
   	stash
   	tag
   	var

<font color="#333333">Suggestion: Maybe that isn't what git is for...</font></pre>
<aside class="notes"><p>We can use this to make custom sections in our error reports. Here you
can see that in addition to the error section we also have a Command section
showing which command we tried to run and a stderr section, showing the
output of the command when it failed. And we'll will dig into this example
more later, so look forward to that…</p>
<div class="next-slide"><p>Next slide: and finally, we can also add errors as sections</p></div>
</aside></div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> cargo run --example multiple_errors
Error:
   0: <font color="#F15D22">encountered multiple errors</font>

Error:
   0: <font color="#F15D22">The task could not be completed</font>
   1: <font color="#F15D22">The task you ran encountered an error</font>

Error:
   0: <font color="#F15D22">The machine is unreachable</font>
   1: <font color="#F15D22">The machine you're connecting to is actively on fire</font>

Error:
   0: <font color="#F15D22">The file could not be parsed</font>
   1: <font color="#F15D22">The file you're parsing is literally written in c++ instead of rust, what the hell</font></pre>
<aside class="notes"><p>Which we can use to aggregate multiple errors into a single report and
format them all consistently.</p>
<p>Now, I'm not giving this talk to talk about eyre and color-eyre.</p>
<div class="next-slide"><p>Next slide: I'm giving this talk to share what I learned in that yak shave to
fix the error handling in my library that resulted in eyre and color-eyre,
and how the process has changed how I look at error handling and error
reporting.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>What Is Error Handling?</h2>

<ul>
<li class="fragment"><del>Annoying</del></li>
<li class="fragment">Defining errors</li>
<li class="fragment">Propagating errors and gathering context</li>
<li class="fragment">Reacting to specific errors</li>
<li class="fragment">Discarding errors</li>
<li class="fragment">Reporting errors and gathered context</li>
</ul>
<aside class="notes"><p>Show the <code>annoying</code> bullet at the end of saying "What is error handling?".</p>
<p>don't mention the annoying, just keep going</p>
<p>It's lot of things, when you zoom in close. Error handling is defining
errors, with types and traits. It's propagating errors and gathering context,
and by context I mean stuff like the path you tried to open or a backtrace
showing where your error came from. It's reacting to specific errors, if the
file isn't found, create the file. It's discarding errors, and doing so
intentionally and visibly. And last but not least, it's reporting errors and
their associated context.</p>
<p>Now, this breakdown gets to the goal of my talk. I have a theory that error
handling is made more confusing by people try to simplify it, because, among
other things, error handling is annoying. I worry that the fuzziness between
these different responsibilities makes it hard for people to infer what tools
they should be using when "handling errors". My hope is that by breaking
error handling into it's component parts we can make it easier to understand
and explain.</p>
<div class="next-slide"><p>Next slide: So let's start with the fundamentals. Note, this first bit is
taken almost word for word from The Rust Book's chapter on error handling.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section class="title-card" data-state="purple"><div class="slide-wrapper">
<h1>Recoverable<br/> vs<br/> Non-Recoverable</h1>
<aside class="notes"><p>The Rust model for errors distinguishes between two classes of errors,
recoverable and non-recoverable errors.</p>
<p>Recoverable errors are errors that can reasonablly be reacted to, or reported
when encountered. These are errors like file not found, or connection closed.</p>
<p>Non-recoverable errors are errors that cannot reasonably be reacted to, only
reported, before exiting the thread or program. These are errors are usually
caused by bugs such as index out of bounds or integer overflow.</p>
<p>Now, most languages dont distinguish between these kinds of errors.</p>
<p>For example, C++ has historically used exceptions for both.</p>
<p>Rust doesnt have exceptions, instead Rust has panic for non-recoverable
errors and result recoverable errors</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Panic</h2>
<pre><code class="language-rust" data-line-numbers="" data-noescape="">// if the index is past the end of the slice
} else if self.end &gt; slice.len() {
    panic!(
        "index {} out of range for slice of length {}",
        self.end,
        slice.len()
    );
}
</code></pre>
<aside class="notes"><p>non-recoverable errors in rust are created via the <code>panic!</code> macro. Here
we can see an example of an index out of bounds error.</p>
<div class="next-slide"><p>Next slide: Only input for the panic macro is an error message and optionally
some context to include in that error message.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Panic</h2>
<pre><code class="language-rust" data-line-numbers="4|5-6" data-noescape="">// if the index is past the end of the slice
} else if self.end &gt; slice.len() {
    panic!(
        "index {} out of range for slice of length {}",
        self.end,
        slice.len()
    );
}
</code></pre>
<aside class="notes"><p>Reporting and default context gathering is done by panic hook, and by
default context gathering I mean capturing the caller location or capturing
the backtrace if it's enabled.</p>
<p>Once the panic hook is done printing the report the panic handler takes over
and cleans up either by unwinding the thread's stack or aborting the
application all together.</p>
<div class="next-slide"><p>Next slide: Result</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Result</h2>
<pre><code class="language-rust" data-line-numbers="1-7|3-4|5-6|1-7" data-noescape="">#[must_use]
enum Result&lt;T, E&gt; {
    /// Contains the success value
    Ok(T),
    /// Contains the error value
    Err(E),
}
</code></pre>
<aside class="notes"><p>Recoverable errors in rust are modeled with the enum <code>Result&lt;T, E&gt;</code>.</p>
<p>This enum has two variants, Ok, which contains the value of an
operation when it completes successfully, and Err, which contains the error
value of an operation when it could <em>not</em> be completed successfully.</p>
<p>We use Result to combine two return types in one and assign meaning to each
possibility.</p>
<div class="next-slide"><p>Next slide: The big advantage of using enums for recoverable errors is that
we must react to all errors.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Result</h2>
<pre><code class="language-rust" data-line-numbers="1-4" data-noescape="">match result {
    Ok(success) =&gt; println!("we got the value {}!", success),
    Err(error) =&gt; println!("uh oh we got an error: {}", error),
}
</code></pre>
<aside class="notes"><p>Here you can see we have to use match (or anything equivalent to
match) to access the values inside of either variant.</p>
<p>With an enum, we cannot access the inner values without first accounting for
all the variants that enum could possibly be. In addition to this, Rust has
marked the Result enum as <code>#[must_use]</code>, which makes the compiler emit a
warning whenever a result is discarded implicitly. This helps us avoid
ignoring errors accidentally and makes discarded errors visible to later
readers.</p>
<div class="next-slide"><p>Next slide: For recoverable errors rust also provides the currently unstable
Try trait and the already stable try operator…</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Try and <code>?</code></h2>
<aside class="notes"><p>The try trait is used to model fallible return types in rust. Indeed,
Result is type that implements the Try trait, as does Option, and other some
combinations thereof.</p>
<div class="next-slide"><p>Next slide: With the try trait rust is able to abstract the "propogation of
errors" with the try operator.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Try and <code>?</code></h2>
<pre><code class="language-rust left" data-line-numbers="1-4|8" data-noescape="">let config = match get_config() {
    Ok(success_value) =&gt; success_value,
    Err(error_value) =&gt; return Err(Error::from(error_value)),
};

// vs

let config = get_config()?;
</code></pre>
<aside class="notes"><p>Here we see two equivalent code snippets. The first manually
propagates the error using match and return. The second does the same by
simply using the try operator to propagate the error.</p>
<div class="next-slide"><p>Next slide: Finally, for recoverable errors rust also provides the error trait.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>The Error Trait</h2>

<ul>
<li class="fragment">Representing an open set of errors</li>
<li class="fragment">Reacting to specific errors in an open set</li>
<li class="fragment">Reporting Interface for all errors</li>
</ul>
<aside class="notes"><p>The error trait fills three roles in rust.</p>
<p>First, it lets us represent an open set of errors by converting any type that
implements the error trait into an error trait object. This is useful for
composing errors, and it is what lets us expose source errors via the error
trait regardless of their actual type.</p>
<p>Second, the error trait lets us then react to specific errors by letting us
try to downcast them back to their original type safely, rather than using
match as we would with enums.</p>
<p>Finally, it provides an interface for reporters.</p>
<div class="next-slide"><p>Next slide: The concept of error reporters isn't a concept that is common in
the rust ecosystem today or any language's error handling ecosystem as far as
I know. However it is vocabulary that I find particularly compelling in the
context of rust error handling, and this is largely because of how rust has
defined it's error trait.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>The Error Trait</h2>
<pre><code class="language-rust" data-line-numbers="1-9|1|2-4|6-9" data-noescape="">pub trait Error: Debug + Display {
    fn source(&amp;self) -&gt; Option&lt;&amp;(dyn Error + 'static)&gt; {
        None
    }

    fn backtrace(&amp;self) -&gt; Option&lt;&amp;Backtrace&gt; {
        None
    }
}
</code></pre>
<aside class="notes"><p>Here is a simplified version of the error trait. Here you can see
we've got two super traits, debug and display, which we must impl to
implement the error trait. Then below that we have two functions, source and
backtrace, both with default impls that we can override when needed.</p>
<div class="next-slide"><p>Next slide: Next lets look at a simple error</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>The Error Trait - An Error</h2>
<pre><code class="language-rust" data-line-numbers="1-2|4|9|13" data-noescape="">#[derive(Debug)]
struct DeserializeError;

impl std::fmt::Display for DeserializeError {
    fn fmt(
        &amp;self,
        f: &amp;mut std::fmt::Formatter&lt;'_&gt;,
    ) -&gt; std::fmt::Result {
        write!(f, "unable to deserialize type")
    }
}

impl std::error::Error for DeserializeError {}
</code></pre>
<aside class="notes"><p>Here we've got an error with no members. We derive debug on it, then
implement display, where we just write our error message and finally we impl
the error trait.</p>
<p>We don't have a source or a backtrace, so we don't need to override any
functions here, which is why the block on the trait implementation is empty.
If we did have a source though we would need to override the <code>source</code>
function to explicitly return a reference to our source when that function is
called by an error reporter.</p>
<div class="next-slide"><p>Next slide: finally lets look at a simple error reporter.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>The Error Trait - A Reporter</h2>
<pre><code class="language-rust" data-line-numbers="" data-noescape="">fn report(error: &amp;(dyn std::error::Error + 'static)) {
    print!("Error:");

    let errors =
        std::iter::successors(Some(error), |e| e.source());

    for (ind, error) in errors.enumerate() {
        print!("\n   {}: {}", ind, error);
    }

    if let Some(backtrace) = error.backtrace() {
        print!("\n\nBacktrace: {}", backtrace);
    }
}
</code></pre>
<aside class="notes"><p>Here we've implemented our reporter as a short free function. This
function takes an error and prints that error and all of its sources,
followed by a backtrace if our error captured one. A more complex error
reporter might also try to check all errors for a backtrace, or if it were a
type and was storing its own context in addition to the error it might print
that as well.</p>
<div class="next-slide"><p>Next slide: In other languages there is no distinction between errors and
reporters, and this is largely due the lack of an equivalent to the Error
Trait.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>The Error Trait</h2>
<pre><code class="language-rust" data-line-numbers="" data-noescape="">trait GoError {
    fn msg(&amp;self) -&gt; String;
}

trait CppError {
    fn msg(&amp;self) -&gt; &amp;'spooky str;
}
</code></pre>
<aside class="notes"><p>The error trait equivalent in other languages is often quite simple,
just a single fn to grab the error message.</p>
<p>These interfaces force you to either include your source error, your
backtrace, and any other information you care about in your error message or
to avoid using the provided interface all together.</p>
<p>In rust we don't have to combine our messages all into one, in fact, you're
encouraged not to. Including a source error's message in your <code>Display</code>
implementation and returning it as your source via the Error trait is
essentially a bug, as it forces reporters to duplicate information when they
print out the chain of error messages.</p>
<div class="next-slide"><p>Next slide: By separating the source and the error message we move the
responsibility of formatting away from the errors themselves, making it
possible to get fancy.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>The Error Trait</h2>
<pre class="term"><font color="#CC0000">ERROR</font> <b>read_config</b>:<b>read_file{</b>path="fake_file"<b>}</b>: Error: Unable
to read config: No such file or directory (os error 2)

// vs

Error:
   0: <font color="#F15D22">Unable to read config</font>
   1: <font color="#F15D22">No such file or directory (os error 2)</font>

  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ SPANTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━

   0: <font color="#F15D22">usage::read_file</font> with <font color="#34E2E2">path="fake_file"</font>
      at <font color="#75507B">examples/usage.rs</font>:<font color="#75507B">52</font>
   1: <font color="#F15D22">usage::read_config</font>
      at <font color="#75507B">examples/usage.rs</font>:<font color="#75507B">58</font></pre>
<aside class="notes"><p>In rust we can have the same error print to a log as one line, but the
screen as many.</p>
<p>This wouldn't be possible if the error trait didn't separate the error
message from other context such as the source error.</p>
<div class="next-slide"><p>Next slide: However, despite the fact that the error trait in rust is more
flexible than most other languages, it is still restrictive in some ways.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>The Error Trait is restrictive</h2>

<ul>
<li class="fragment">Can only represent errors with a single source</li>
<li class="fragment">Can only access 3 forms of context</li>
</ul>
<aside class="notes"><p>If you've ever written a parser you might have run into this, where
you have multiple syntax errors at once, but you can only return one via
<code>source</code>. The error trait can only represent a chain of errors as a singly
linked list, not as a tree, and so it doesn't work for every situation.</p>
<p>Can't return types like SpanTrace without using hacks based on downcast to
work around the error trait.</p>
<p>This prevents us from having things like Error return traces in zig, though I
do have plans on how we can fix these problems so in the future this may no
longer be an issue.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>TIPS - Reporters</h2>
<ul>
<li>Reporters usually impl <code>From&lt;E: Error&gt;</code></li>
<li>if they do they <em>cannot</em> impl <code>Error</code></li>
<li>don't compose well</li>
<li>They often carry extra context</li>
<li>Prints report via <code>Debug</code> trait</li>
</ul>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><style>
.container{
    display: flex;
}
.col{
    flex: 1;
}
</style>
<div class="container">
<div class="col">
 Recoverable

<ul>
<li class="fragment">Defining
<ul>
<li class="fragment">types and traits</li>
</ul>
</li>
<li class="fragment">Propagating
<ul>
<li class="fragment"><code>?</code></li>
</ul>
</li>
<li class="fragment">Matching and Reacting
<ul>
<li class="fragment"><code>match</code> or <code>downcast</code></li>
</ul>
</li>
<li class="fragment">Discarding
<ul>
<li class="fragment"><code>drop</code> or <code>unwrap</code></li>
</ul>
</li>
<li class="fragment">Reporting
<ul>
<li class="fragment">Reporting types and hook</li>
</ul>
</li>
</ul>
</div>
<div class="col">
Non-Recoverable

<ul>
<li class="fragment">Defining
<ul>
<li class="fragment"><code>panic!</code></li>
</ul>
</li>
<li class="fragment">Propagating
<ul>
<li class="fragment">builtin</li>
</ul>
</li>
<li class="fragment">Matching and Reacting
<ul>
<li class="fragment">pls don’t</li>
</ul>
</li>
<li class="fragment">Discarding
<ul>
<li class="fragment"><code>catch_unwind</code></li>
</ul>
</li>
<li class="fragment">Reporting
<ul>
<li class="fragment">panic hook</li>
</ul>
</li>
</ul>
</div>
</div>
<aside class="notes"><p>Okay so now we’ve covered the fundamentals, you know all the tools the
language and standard library give you to work with different kinds of
errors.</p>
<div class="next-slide"><p>Next slide: So next let’s dig into my favorite part of error handling, error
reporting, and how it fits into the bigger picture, starting with some
definitions…</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Definitions</h2>

<ul>
<li class="fragment"><strong>Error</strong>: A description of why an operation failed</li>
<li class="fragment"><strong>Context</strong>: Any information relevant to an error or an error report that
is not itself an error</li>
<li class="fragment"><strong>Error Report</strong>: Printed representation of an error and all of its
associated context</li>
</ul>
<aside class="notes"><p>In the context of error reporting an error is ..., context is ..., and
an error report is the …</p>
<p>This gets to the other goal of this talk, clarifying the relationship between
errors and context. Errors describe what went wrong, context helps you figure
out why, and it's my opinion that keeping these two concepts separate leads
to more readable error reports and that adding just a little context can take
your error reports from somewhat servicable to oddly satisfying.</p>
<div class="next-slide"><p>Next slide: I think the best way to explain what I mean will be with an
example, so let's dig into error reporting real quick by recreating the
custom_section example from the beginning of the talk.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<pre><code class="language-rust" data-line-numbers="1-3|5|7|9-10|12|13|15" data-noescape="">trait CommandExt {
    fn output2(&amp;mut self) -&gt; Result&lt;String, eyre::Report&gt;;
}

impl CommandExt for std::process::Command {
    fn output2(&amp;mut self) -&gt; Result&lt;String, eyre::Report&gt; {
        let output = self.output()?;

        let stdout = String::from_utf8_lossy(&amp;output.stdout)
            .into_owned();

        if output.status.success() {
            Ok(stdout)
        } else {
            Err(eyre!("command exited unsuccessfully"))
        }
    }
}
</code></pre>
<aside class="notes"><p>lets start with a customized version of <code>Command::output</code> that reports
better errors and converts stdout to a String on success.</p>
<div class="next-slide"><p>Next slide: lets run it…</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> cargo run
Error:
   0: <font color="#F15D22">command exited unsuccessfully</font></pre>
<aside class="notes"><p>We got our error report with our error message, cool! But also not
very helpful, I didn't even tell you what command I was running. Lets figure
that out next.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<pre><code class="language-rust" data-line-numbers="10|13" data-noescape="">impl CommandExt for std::process::Command {
    fn output2(&amp;mut self) -&gt; Result&lt;String, eyre::Report&gt; {
        let output = self.output()?;

        let stdout = String::from_utf8_lossy(&amp;output.stdout).into_owned();

        if output.status.success() {
            Ok(stdout)
        } else {
            let cmd = format!("{:?}", self);

            Err(eyre!("command exited unsuccessfully"))
                .section(cmd.header("Command:"))
        }
    }
}
</code></pre>
<aside class="notes"><p>Header takes a type that implements display and prefixes the header
before printing it, and section takes a type that implements display and
prints it after the chain of errors.</p>
<div class="next-slide"><p>Next slide: so lets see how this changes things…</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> cargo run
Error:
   0: <font color="#F15D22">command exited unsuccessfully</font>

Command:
   "git" "cat"</pre>
<aside class="notes"><p>Here we can see why the command failed, cat isn't a real git command!
It would be cool if it was though.</p>
<p>This is context, and the whole thing is a report.</p>
<div class="next-slide"><p>Next slide: Now, this error isn't very descriptive. Sure, it describes what
went wrong, but it is far too generic. Let's go ahead and define a new error
with a more descriptive error message to wrap our source error.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<pre><code class="language-rust left" data-line-numbers="" data-noescape="">fn main() -&gt; Result&lt;(), eyre::Report&gt; {
    color_eyre::install()?;

    let _ = std::process::Command::new("git")
        .arg("cat")
        .output2()?;


    Ok(())
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<pre><code class="language-rust left" data-line-numbers="7" data-noescape="">fn main() -&gt; Result&lt;(), eyre::Report&gt; {
    color_eyre::install()?;

    let _ = std::process::Command::new("git")
        .arg("cat")
        .output2()
        .wrap_err("the cat could not be got")?;

    Ok(())
}
</code></pre>
<aside class="notes"><p>This function takes a Result and an arg that implements Display, and
if the Result is the <code>Err</code> variant it creates a new error, using the arg as
the error message and the old error as the source. It then returns this new
error as an eyre::Report.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> cargo run
Error:
   0: <font color="#F15D22">the cat could not be got</font>
   1: <font color="#F15D22">command exited unsuccessfully</font>

Command:
   "git" "cat"

</pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<pre><code class="language-rust" data-line-numbers="7-9|13-14" data-noescape="">        let stdout = String...

        if output.status.success() {
            Ok(stdout)
        } else {
            let cmd = format!("{:?}", self);
            let stderr =
                String::from_utf8_lossy(&amp;output.stderr)
                    .into_owned();

            Err(eyre!("command exited unsuccessfully"))
                .section(cmd.header("Command:"))
                .section(stdout.header("Stdout:"))
                .section(stderr.header("Stderr:"))
        }
    }
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#4E9A06"><b>❯</b></font> cargo run
Error:
   0: <font color="#F15D22">the cat could not be got</font>
   1: <font color="#F15D22">command exited unsuccessfully</font>

Command:
   "git" "cat"

Stderr:
   git: 'cat' is not a git command. See 'git --help'.

   The most similar commands are
   	clean
   	mktag
   	stage
   	stash
   	tag
   	var</pre>
<aside class="notes"><p>And finally we have an error report including all the information we
need. With it we can pinpoint what went wrong, why it went wrong, and, as an
added bonus, how we can fix it.</p>
<p>Hopefully this makes it clear how benefitial just a little context can be for
error reports.</p>
<div class="next-slide"><p>Next slide: By now you should know all the tools built into the language,
how they fit into the various pieces of error handling, and have an
understanding of how they can be combined to write error reports. So lets
look at the ecosystem at large to see what open source libraries we can use
to help us with our five parts of error handling.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Libraries</h2>
<ul>
<li>Defining</li>
<li>Propagating and Gathering Context</li>
<li>Matching and Reacting</li>
<li>Discarding</li>
<li>Reporting</li>
</ul>
<aside class="notes"><p>I'm going to introduce these libraries by how they fit into our error
handling breakdown, not every part will have libraries to help and some will
be disproportionately represented.</p>
<div class="next-slide"><p>Next slide: First I'd like to introduce thiserror.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Defining - thiserror</h2>
<pre><code class="language-rust" data-line-numbers="" data-noescape="">#[derive(Debug)]
pub enum DataStoreError {

    Disconnect(io::Error),

    Redaction(String),

    InvalidHeader {
        expected: String,
        found: String,
    },

    Unknown,
}
</code></pre>
<aside class="notes"><p>This error is an error derive macro, and it exists to reduce boiler
plate by implementing commonly used traits for you, such as Error, Display,
and From.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Defining - thiserror</h2>
<pre><code class="language-rust" data-line-numbers="" data-noescape="">#[derive(Debug, thiserror::Error)]
pub enum DataStoreError {

    Disconnect(io::Error),

    Redaction(String),

    InvalidHeader {
        expected: String,
        found: String,
    },

    Unknown,
}
</code></pre>
<aside class="notes"><p>To use it, we start by adding the macro's identifier to our derive
attribute.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Defining - thiserror</h2>
<pre><code class="language-rust" data-line-numbers="1-14|3|5|7|4" data-noescape="">#[derive(Debug, thiserror::Error)]
pub enum DataStoreError {
    #[error("data store disconnected")]
    Disconnect(io::Error),
    #[error("the data for key `{0}` is not available")]
    Redaction(String),
    #[error("invalid header (expected {expected:?}, found {found:?})")]
    InvalidHeader {
        expected: String,
        found: String,
    },
    #[error("unknown data store error")]
    Unknown,
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Defining - thiserror</h2>
<pre><code class="language-rust" data-line-numbers="4" data-noescape="">#[derive(Debug, thiserror::Error)]
pub enum DataStoreError {
    #[error("data store disconnected")]
    Disconnect(#[source] io::Error),
    #[error("the data for key `{0}` is not available")]
    Redaction(String),
    #[error("invalid header (expected {expected:?}, found {found:?})")]
    InvalidHeader {
        expected: String,
        found: String,
    },
    #[error("unknown data store error")]
    Unknown,
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Defining - thiserror</h2>
<pre><code class="language-rust" data-line-numbers="4|1-14" data-noescape="">#[derive(Debug, thiserror::Error)]
pub enum DataStoreError {
    #[error("data store disconnected")]
    Disconnect(#[from] io::Error),
    #[error("the data for key `{0}` is not available")]
    Redaction(String),
    #[error("invalid header (expected {expected:?}, found {found:?})")]
    InvalidHeader {
        expected: String,
        found: String,
    },
    #[error("unknown data store error")]
    Unknown,
}
</code></pre>
<aside class="notes"><div class="next-slide"><p>Next slide: Next I'd like to introduce <code>displaydoc</code></p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Defining - displaydoc</h2>
<pre><code class="language-rust" data-line-numbers="" data-noescape="">#[derive(Debug, thiserror::Error, displaydoc::Display)]
pub enum DataStoreError {
    /// data store disconnected
    Disconnect(#[from] io::Error),
    /// the data for key `{0}` is not available
    Redaction(String),
    /// invalid header (expected {expected:?}, found {found:?})
    InvalidHeader {
        expected: String,
        found: String,
    },
    /// unknown data store error
    Unknown,
}
</code></pre>
<aside class="notes"><p>Display doc is a fork of thiserror that provides only the display
derive portion of this error, but uses doc comments instead of custom
attributes to input the format strings.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Defining Errors &amp; Gathering Context - SNAFU</h2>
<pre><code class="language-rust" data-line-numbers="1-13|1|2-4|10-11" data-noescape="">#[derive(Debug, Snafu)]
enum Error {
    #[snafu(display("Unable to read configuration from {}: {}", path.display(), source))]
    ReadConfiguration { source: io::Error, path: PathBuf },
}

fn process_data() -&gt; Result&lt;(), Error&gt; {
    let path = "config.toml";
    let configuration = fs::read_to_string(path)
        // wrap error while capturing `path` as context
        .context(ReadConfiguration { path })?;
    Ok(())
}
</code></pre>
<aside class="notes"><p>The context function takes a result and a "Context Selector" struct
which is autogenerated by the derive macro. This struct implicitly passes
along context like the source and backtrace, making it so you only have to
capture additional context that is unique that your error variant. It then
internally creates the correct wrapping error variant. You can think of it as
syntax sugar for <code>map_err</code>.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Defining - anyhow/eyre</h2>
<pre><code class="language-rust" data-line-numbers="1-2|4-6" data-noescape="">// Construct an ad-hoc error
Err(eyre!("file not found"))?

// Constructing an ad-hoc wrapping error
fallible_fn()
    .wrap_err("failed operation")?;
</code></pre>
<aside class="notes"><p>anyhow and eyre also have helpers for defining new errors. However,
these functions don't help you define new error types, instead they use
private types to create the new errors and then they immediately wrap those
types in the main reporting type e.g. <code>eyre::Report</code>. This is mostly useful
for when you want to create errors exclusively to report them, though these
crates do also provide some helpers for then later reacting to these adhoc
error types.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>TIPS - Defining</h2>
<ul>
<li>Open Set vs Closed Set</li>
<li>Stack Size</li>
<li>Unreportable Errors</li>
</ul>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Propagating - fehler</h2>
<pre><code class="language-rust" data-noescape="">#[fehler::throws(i32)]
fn foo(x: bool) -&gt; i32 {
    if x {
        0
    } else {
        fehler::throw!(1);
    }
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Gathering Context - tracing-error</h2>
<pre><code class="language-rust" data-line-numbers="2|3|5-7" data-noescape="">let error = std::fs::read_to_string("myfile.txt")
    .in_current_span();
let error: &amp;(dyn std::error::Error + 'static) = &amp;error;

if let Some(spantrace) = error.span_trace() {
    eprintln!("found a spantrace:\n{}", spantrace);
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Gathering Context - extracterr</h2>
<pre><code class="language-rust" data-noescape="">type Error = extracter::Bundled&lt;ExampleError, backtrace::Backtrace&gt;;

fn foo() -&gt; Result&lt;(), Error&gt; {
    Err(ExampleError)?
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Matching and Reacting</h2>
<aside class="notes"><p>mostly handled by builtin features, match, downcast.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Matching and Reacting - anyhow/eyre</h2>
<pre><code class="language-rust" data-noescape="">use <a href="https://docs.rs/eyre">eyre</a>::WrapErr;

#[derive(Debug, displaydoc::Display)]
/// Foo error
struct FooError;

let report = fallible_fn()
    .wrap_err(FooError)
    .unwrap_err();

let foo_error = report.downcast_ref::&lt;FooError&gt;().unwrap();
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Discarding</h2>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Reporting</h2>
<ul>
<li>Reporters: anyhow/eyre</li>
<li>Hooks: color-eyre, jane-eyre, color-anyhow (soon), color-backtrace</li>
</ul>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Library vs Application</h2>
<ul>
<li>Library =&gt; error defining libraries</li>
<li>Application =&gt; adhoc error defining + error reporting libraries</li>
</ul>
<aside class="notes"><p>What parts of error handling do you need as a library developer? You
probably don't know, because you're not the one handling errors as a library
developer. Libraries usually create and return errors for applications to
react to or report. This means we need errors that are maximally flexible, so
we need something users can match and react too, that means either an enum or
a dyn Error with downcast. We also want an error that can be wrapped by other
errors easily, which means we want to impl the Error trait on our error type,
so that rules out <code>Box&lt;dyn Error&gt;</code>, finally we want to be able to report it,
so we should impl the Error trait. All of this means we need to define
errors, which we can do with types and traits, either by hand or with helper
libraries like <code>thiserror</code> or <code>SNAFU</code>.</p>
<p>I tend to go with the implemented by hand option in libraries that I expect
other ppl to use, because proc macros can add a lot of time to your build,
but in my applications I tend to use thiserror for convenience.</p>
<p>So what does that mean for applications? We need to be able to handle lots of
error types, so we probably want open set error handling, that means box<dyn error=""> or a reporter like <code>eyre</code> or <code>anyhow</code>. We also need to be able to
create errors that we handle, if they're handled immediately we probably
don't need to introduce much at all, we could just impl an enum and handle it
and not bother with the error trait or anything. If we need to create an
error that will just be reported we don't need types or handling, so we can
use ad-hoc error construction, which makes reporters a better option than a
simple Box. And we probably need more tools for debugging our errors, so we
want a featureful error reporter that captures enough context to help us
debug our applications, so we might want a custom report hook like
<code>color-eyre</code> and maybe some tracing integration with <code>tracing-error</code>.</dyn></p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h1>Fin</h1>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby (she/her)</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
        </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script src="plugin/highlight/rust.js"></script>
    <script src="plugin/highlight/shell.js"></script>
    <script>
        Reveal.initialize({
            width: 960,
            height: 540,
            hash: true,
            controls: false,
            progress: false,
            showNotes: true,
            transition: 'none',
            /* vertical- */ center: false,
            markdown: {
                smartypants: true,
            },
            plugins: [RevealMarkdown, HighlightRustCompiler, HighlightShellSession, RevealHighlight, RevealNotes]
        });
    </script>


</body></html>
