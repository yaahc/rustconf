<!DOCTYPE html>
<html lang="en-US"><head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>

    <title>Error Handling Isn't All About Errors</title>

    <link href="dist/reset.css" rel="stylesheet"/>
    <link href="dist/reveal.css" rel="stylesheet"/>
    <link href="dist/theme/rustconf.css" id="theme" rel="stylesheet"/>
    <link href="plugin/highlight/rustconf.css" id="highlight-theme" rel="stylesheet"/>
    <script crossorigin="anonymous" src="https://kit.fontawesome.com/9144026ed3.js"></script>
</head>

<body>
    <div class="reveal">
        <div class="slides">
            <section><div class="slide-wrapper">
<h1>Error Handling Isn't All About Errors</h1>
<p><span class="author">Jane Lusby</span></p>
<p><i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a></p>
<p>Slide Template by Rebecca Turner <i class="fa-twitter fab"></i> <a href="https://twitter.com/16kbps">@16kbps</a> / <a href="https://becca.ooo/">becca.ooo</a></p>
<aside class="notes"><p>Hello and welcome to my talk, error handling isn't all about errors.</p>
<div class="next-slide"><p>Next slide: Let me start by introducing myself…</p></div>

</aside></div></section>
<section class="center"><div class="slide-wrapper">
<h2>About Me</h2>
<aside class="notes"><p>My name is Jane Lusby. On the internet I go by Yaah or Yaahc. I've
been writing rust for two and a half years though I was only recently hired
to do so professionally, by The Zcash Foundation. I got into error handling
on accident, it started as a yak shave when I wanted to open source a library
I wrote for work but I wasn't happy with the error handling and decided to
fix it up first.</p>
<p>That yak shave ended with me writing eyre, a fork of anyhow with support for
customized error report hooks, and color-eyre, which provides a custom panic
hook and a custom eyre report hook and lets you construct error reports like
this.</p>
<div class="next-slide"><p>Next slide: Show the various usage examples from <code>color-eyre</code>.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> cargo run --example usage
Error:
   0: <font color="#F15D22">Unable to read config</font>
   1: <font color="#F15D22">No such file or directory (os error 2)</font>

  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ SPANTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━

   0: <font color="#F15D22">usage::read_file</font> with <font color="#34E2E2">path="fake_file"</font>
      at <font color="#75507B">examples/usage.rs</font>:<font color="#75507B">32</font>
   1: <font color="#F15D22">usage::read_config</font>
      at <font color="#75507B">examples/usage.rs</font>:<font color="#75507B">38</font>

<font color="#34E2E2">Suggestion</font>: try using a file that exists next time

Backtrace omitted.
Run with RUST_BACKTRACE=1 environment variable to display it.
Run with RUST_BACKTRACE=full to include source snippets.</pre>
<aside class="notes"><p>this is the basic usage example, with an error section, a spantrace section which, if you're not familiar with tracing is this extremely cool backtrace-like type of tracing spans..., a suggestion, and an env setting section.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> RUST_BACKTRACE=1 cargo run --example usage
// ...
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━
  <font color="#34E2E2">                       ⋮ 5 frames hidden ⋮                       </font>
   6: <font color="#F15D22">usage::read_file</font><font color="#88807C">::h10b2389c2b814452</font>
      at <font color="#75507B">/home/jlusby/git/yaahc/color-eyre/examples/usage.rs</font>:<font color="#75507B">35</font>
   7: <font color="#F15D22">usage::read_config</font><font color="#88807C">::hf7150b146edb25d9</font>
      at <font color="#75507B">/home/jlusby/git/yaahc/color-eyre/examples/usage.rs</font>:<font color="#75507B">40</font>
   8: <font color="#F15D22">usage::main</font><font color="#88807C">::hc3df11a6ea0d044d</font>
      at <font color="#75507B">/home/jlusby/git/yaahc/color-eyre/examples/usage.rs</font>:<font color="#75507B">11</font>
  <font color="#34E2E2">                      ⋮ 10 frames hidden ⋮                       </font>
// ...
Run with RUST_BACKTRACE=full to include source snippets.</pre>
<aside class="notes"><p>we can pretty print backtraces and hide unimportant frames, here you can see...</p>
<div class="next-slide"><p>Next slide: we can also filter our backtrace frames, note that here there are 10 frames hidden after main…</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> RUST_BACKTRACE=1 cargo run --example custom_filter
// ...
  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ BACKTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━
  <font color="#34E2E2">                       ⋮ 5 frames hidden ⋮                       </font>
   6: <font color="#F15D22">custom_filter::read_file</font><font color="#88807C">::h0afee8fe0960bf02</font>
      at <font color="#75507B">/home/jlusby/git/yaahc/color-eyre/examples/custom_filter.rs</font>:<font color="#75507B">53</font>
   7: <font color="#F15D22">custom_filter::read_config</font><font color="#88807C">::h6622065848c69b29</font>
      at <font color="#75507B">/home/jlusby/git/yaahc/color-eyre/examples/custom_filter.rs</font>:<font color="#75507B">58</font>
  <font color="#34E2E2">                      ⋮ 11 frames hidden ⋮                       </font>
// ...
Run with RUST_BACKTRACE=full to include source snippets.</pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> cargo run --example custom_section
Error:
   0: <font color="#F15D22">Unable to read config</font>
   1: <font color="#F15D22">cmd exited with non-zero status code</font>

Stderr:
   cat: fake_file: No such file or directory

  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ SPANTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━

   0: <font color="#F15D22">custom_section::output2</font> with <font color="#34E2E2">self="cat" "fake_file"</font>
      at <font color="#75507B">examples/custom_section.rs</font>:<font color="#75507B">14</font>
   1: <font color="#F15D22">custom_section::read_file</font> with <font color="#34E2E2">path="fake_file"</font>
      at <font color="#75507B">examples/custom_section.rs</font>:<font color="#75507B">58</font>
   2: <font color="#F15D22">custom_section::read_config</font>
      at <font color="#75507B">examples/custom_section.rs</font>:<font color="#75507B">63</font></pre>
<aside class="notes"><p>We can add custom sections, here you can see I've added the section
for Stderr</p>
<div class="next-slide"><p>Next slide: We will dig into this example more later…</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> cargo run --example multiple_errors
Error:
   0: <font color="#F15D22">encountered multiple errors</font>

Error:
   0: <font color="#F15D22">The task could not be completed</font>
   1: <font color="#F15D22">The task you ran encountered an error</font>

Error:
   0: <font color="#F15D22">The machine is unreachable</font>
   1: <font color="#F15D22">The machine you're connecting to is actively on fire</font>

Error:
   0: <font color="#F15D22">The file could not be parsed</font>
   1: <font color="#F15D22">The file you're parsing is literally written in c++ instead of rust, what the hell</font></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> cargo run --example panic_hook
<font color="#CC0000">The application panicked (crashed).</font>
Message:  <font color="#06989A">some real basic stuff went wrong</font>
Location: <font color="#75507B">examples/panic_hook.rs</font>:<font color="#75507B">14</font>

  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ SPANTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━

   0: <font color="#F15D22">panic_hook::do_thing</font> with <font color="#34E2E2">thing=42</font>
      at <font color="#75507B">examples/panic_hook.rs</font>:<font color="#75507B">12</font>

Backtrace omitted.
Run with RUST_BACKTRACE=1 environment variable to display it.
Run with RUST_BACKTRACE=full to include source snippets.</pre>
<aside class="notes"><p>And we can be consistent when reporting, here you can see a panic
that produces almost identical output to our Eyre Reports.</p>
<p>Now, I'm not giving this talk to talk about eyre.</p>
<div class="next-slide"><p>Next slide: I'm giving this talk to share what I learned in that yak shave to
fix the error handling in my library, and how it has changed how I look at
error handling and error reporting.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>What Is Error Handling?</h2>

<ul>
<li class="fragment"><del>Annoying</del></li>
<li class="fragment">Defining errors</li>
<li class="fragment">Propagating errors and gathering context</li>
<li class="fragment">Reacting to specific errors</li>
<li class="fragment">Discarding errors</li>
<li class="fragment">Reporting errors and gathered context</li>
</ul>
<aside class="notes"><p>A lot of things, when you zoom in close</p>
<p>don't mention the annoying, just keep going</p>
<p>The breakdown here gets to the goal of my talk. I have a theory that
error handling is made more confusing by people try to simplify it, because,
among other things, error handling is annoying. I worry that the fuzziness
between these different responsibilities makes it hard for people to infer
what tools they should be using when "handling errors". My hope is that by breaking error handling into it's component parts we can make it easier to understand and explain.</p>
<div class="next-slide"><p>Next slide: So let's start with the fundamentals. Note, this first bit is taken almost word for word from The Rust Book's chapter on error handling.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section class="title-card" data-state="purple"><div class="slide-wrapper">
<h1>Recoverable<br/> vs<br/> Non-Recoverable</h1>
<aside class="notes"><p>The Rust model for errors distinguishes between two classes of errors.</p>
<p>Recoverable errors are errors you can reasonably expect to occur during execution of…, can be reacted to, or reported.</p>
<p>Unrecoverable errors are bugs, like index out of bounds. can’t be reacted to, only reported before exiting the program / thread</p>
<p>Most languages dont distinguish between these kinds of errors</p>
<p>C++ has exceptions</p>
<p>Rust doesnt</p>
<p>Rust has panic for unrecoverable errors and result recoverable errors</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Panic</h2>
<pre><code class="language-rust" data-line-numbers="" data-noescape="">// if the index is past the end of the slice
} else if self.end &gt; slice.len() {
    panic!(
        "index {} out of range for slice of length {}",
        self.end,
        slice.len()
    );
}
</code></pre>
<aside class="notes"><p>Unrecoverable errors in rust are created via the <code>panic!</code> macro. Here we can see an example of an index out of bounds error.</p>
<div class="next-slide"><p>Next slide: Only input is an error message and optional some context</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Panic</h2>
<pre><code class="language-rust" data-line-numbers="4|5-6" data-noescape="">// if the index is past the end of the slice
} else if self.end &gt; slice.len() {
    panic!(
        "index {} out of range for slice of length {}",
        self.end,
        slice.len()
    );
}
</code></pre>
<aside class="notes"><p>Reporting and default context gathering done by panic hook</p>
<p>once its done printing the report the panic handler cleans up either by unwinding or aborting</p>
<div class="next-slide"><p>Next slide: Recoverable errors are modeled in rust with the enum <code>Result&lt;T, E&gt;</code>.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Result</h2>
<pre><code class="language-rust" data-line-numbers="1-6|2-3|4-5" data-noescape="">enum Result&lt;T, E&gt; {
    /// Contains the success value
    Ok(T),
    /// Contains the error value
    Err(E),
}
</code></pre>
<aside class="notes"><p>This enum has two variants,</p>
<p>This is used to combine two return types in one and assign meaning to each possibility.</p>
<p>This enum concisely describes whether and how errors are returned.</p>
<div class="next-slide"><p>Next slide: The big advantage of using enums is we must handle all errors.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Result</h2>
<pre><code class="language-rust" data-line-numbers="1-4" data-noescape="">match result {
    Ok(success) =&gt; println!("we got the value {}!", success),
    Err(error) =&gt; println!("uh oh we got an error: {}", error),
}
</code></pre>
<aside class="notes"><div class="next-slide"><p>Next slide: next is the try trait and operator...</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Try and <code>?</code></h2>
<pre><code class="language-rust left" data-line-numbers="1-4|8" data-noescape="">let config = match get_config() {
    Ok(success_value) =&gt; success_value,
    Err(error_value) =&gt; return Err(Error::from(error_value)),
};

// vs

let config = get_config()?;
</code></pre>
<aside class="notes"><p>The unstable try trait models fallible operations and is currently used to define how to convert a type to and from a Result.</p>
<p>Indeed, Result is type that implements the Try trait, as does Option, and other some combinations thereof.</p>
<p>Abstraction over error propagation</p>
<div class="next-slide"><p>Next slide: Next up is the error trait.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>The Error Trait</h2>

<ul>
<li class="fragment">Representing an open set of errors</li>
<li class="fragment">Reacting to specific errors in an open set.</li>
<li class="fragment">Reporting Interface for all errors</li>
</ul>
<aside class="notes"><p>fills three roles</p>
<p>Represent them by converting them to a trait object.</p>
<p>You can then later react to specific errors by downcasting back to the original type, rather than using match as you would with enums.</p>
<div class="next-slide"><p>Next slide: Now, what do I mean by this?</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>The Error Trait</h2>

<ul>
<li class="fragment">Backtrace via <code>backtrace()</code></li>
<li class="fragment">Cause via <code>source()</code></li>
<li class="fragment">Error Message via <code>Display</code></li>
</ul>
<aside class="notes"><p>The error trait is how reporters access context that was captured for them.</p>
<p>This includes…</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section class="title-card" data-state="purple"><div class="slide-wrapper">
<h1>The error trait provides an interface <em>for</em> reporters.</h1>
<p>Next slide: In other languages there is no distinction between errors and
reporters, and this is largely due the lack of an equivalent to the Error
Trait.</p>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>The Error Trait</h2>
<pre><code class="language-rust" data-line-numbers="" data-noescape="">trait GoError {
    fn msg(&amp;self) -&gt; String;
}

trait CppError {
    fn msg(&amp;self) -&gt; &amp;'spooky str;
}
</code></pre>
<aside class="notes"><p>The error trait equivalent in other languages is often quite simple, just a single fn to grab the error message.</p>
<p>These interfaces force you to either include your source error, your
backtrace, and any other information you care about in your error message or
to avoid using the provided interface all together.</p>
<p>In rust we don't have to combine our messages all into one, in fact, you're
encouraged not to. Including a source error's message in your <code>Display</code>
implementation and returning it as your source via the Error trait is
essentially a bug, and it forces reporters to duplicate information when they
print out the chain of error messages.</p>
<div class="next-slide"><p>Next slide: By separating the source and the error message we move the
responsibility of formatting away from the errors themselves, making it
easier to get fancy.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>The Error Trait</h2>
<pre class="term"><font color="#CC0000">ERROR</font> <b>read_config</b>:<b>read_file{</b>path="fake_file"<b>}</b>: Error: Unable
to read config: No such file or directory (os error 2)

// vs

Error:
   0: <font color="#F15D22">Unable to read config</font>
   1: <font color="#F15D22">No such file or directory (os error 2)</font>

  ━━━━━━━━━━━━━━━━━━━━━━━━━━━ SPANTRACE ━━━━━━━━━━━━━━━━━━━━━━━━━━━

   0: <font color="#F15D22">usage::read_file</font> with <font color="#34E2E2">path="fake_file"</font>
      at <font color="#75507B">examples/usage.rs</font>:<font color="#75507B">52</font>
   1: <font color="#F15D22">usage::read_config</font>
      at <font color="#75507B">examples/usage.rs</font>:<font color="#75507B">58</font></pre>
<aside class="notes"><p>In rust we can have the same error print to a log as one line, but the
screen as many.</p>
<p>This wouldn't be possible if the error trait didn't separate context from errors.</p>
<div class="next-slide"><p>Next slide: However, despite the fact that the error trait in rust is more flexible than most other languages, it is still restrictive in some ways.</p></div>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>The Error Trait is restrictive</h2>

<ul>
<li class="fragment">Can only represent errors with a single source</li>
<li class="fragment">Can only access 3 forms of context</li>
</ul>
<aside class="notes"><p>Can't return types like SpanTrace without using hacks based on downcast to work around the error trait.</p>
<p>Error return traces</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><style>
.container{
    display: flex;
}
.col{
    flex: 1;
}
</style>
<div class="container">
<div class="col">
 Recoverable

<ul>
<li class="fragment">Defining
<ul>
<li class="fragment">types and traits</li>
</ul>
</li>
<li class="fragment">Propagating
<ul>
<li class="fragment"><code>?</code></li>
</ul>
</li>
<li class="fragment">Matching and Reacting
<ul>
<li class="fragment"><code>match</code> or <code>downcast</code></li>
</ul>
</li>
<li class="fragment">Discarding
<ul>
<li class="fragment"><code>drop</code> or <code>unwrap</code></li>
</ul>
</li>
<li class="fragment">Reporting
<ul>
<li class="fragment">Reporting types and hook</li>
</ul>
</li>
</ul>
</div>
<div class="col">
Unrecoverable

<ul>
<li class="fragment">Defining
<ul>
<li class="fragment"><code>panic!</code></li>
</ul>
</li>
<li class="fragment">Propagating
<ul>
<li class="fragment">builtin</li>
</ul>
</li>
<li class="fragment">Matching and Reacting
<ul>
<li class="fragment">pls don’t</li>
</ul>
</li>
<li class="fragment">Discarding
<ul>
<li class="fragment"><code>catch_unwind</code></li>
</ul>
</li>
<li class="fragment">Reporting
<ul>
<li class="fragment">panic hook</li>
</ul>
</li>
</ul>
</div>
</div>
<aside class="notes"><p>Okay so now we’ve covered the fundamentals, you know how to handle errors of both types, so let’s get back and start digging into the differences between errors, context, and reports.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Definitions</h2>

<ul>
<li class="fragment"><strong>Error</strong>: A description of why an operation failed</li>
<li class="fragment"><strong>Context</strong>: Any information relevant to an error or an error report that is not itself an error</li>
<li class="fragment"><strong>Error Report</strong>: Printed representation of an error and all of its associated context</li>
</ul>
<aside class="notes"><p>This is in the context of reporting, we will no longer talk about handling.</p>
<p>This gets to the other goal of this talk, clarifying the relationship and
difference between errors and context. Errors describe what went wrong,
context helps you figure out the why, and it's my opinion that keeping these
two concepts in mind is very important when designing your error reporting.</p>
<p>How about an example? Let's dig into error reporting by recreating the
custom_section example from the beginning of the talk. NEXT SLIDE</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<pre><code class="language-rust" data-line-numbers="1-3|5|7|9-10|12|13|15" data-noescape="">trait CommandExt {
    fn output2(&amp;mut self) -&gt; Result&lt;String, eyre::Report&gt;;
}

impl CommandExt for std::process::Command {
    fn output2(&amp;mut self) -&gt; Result&lt;String, eyre::Report&gt; {
        let output = self.output()?;

        let stdout = String::from_utf8_lossy(&amp;output.stdout)
            .into_owned();

        if !output.status.success() {
            Err(eyre!("command exited unsuccessfully"))
        } else {
            Ok(stdout)
        }
    }
}
</code></pre>
<aside class="notes"><p>lets start with a customized version of <code>Command::output</code> that reports
better errors and converts stdout to a String on success.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> cargo run
Error:
   0: <font color="#F15D22">command exited unsuccessfully</font></pre>
<aside class="notes"><p>This is an Error.</p>
<p>okay, thats not very helpful, also I didn't even tell you what command I was running</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<pre><code class="language-rust" data-line-numbers="8|11" data-noescape="">impl CommandExt for std::process::Command {
    fn output2(&amp;mut self) -&gt; Result&lt;String, eyre::Report&gt; {
        let output = self.output()?;

        let stdout = String::from_utf8_lossy(&amp;output.stdout).into_owned();

        if !output.status.success() {
            let cmd = format!("{:?}", self);

            Err(eyre!("command exited unsuccessfully"))
                .section(cmd.header("Command:"))
        } else {
            Ok(stdout)
        }
    }
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> cargo run
Error:
   0: <font color="#F15D22">command exited unsuccessfully</font>

Command:
   "git" "cat"</pre>
<aside class="notes"><p>Here we can see why the command failed, cat isn't a real git command! It would be cool if it was though.</p>
<p>This is context, and the whole thing is a report.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<pre><code class="language-rust left" data-line-numbers="" data-noescape="">fn main() -&gt; Result&lt;(), eyre::Report&gt; {
    color_eyre::install()?;

    let _ = std::process::Command::new("git")
        .arg("cat")
        .output2()?;


    Ok(())
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<pre><code class="language-rust left" data-line-numbers="7" data-noescape="">fn main() -&gt; Result&lt;(), eyre::Report&gt; {
    color_eyre::install()?;

    let _ = std::process::Command::new("git")
        .arg("cat")
        .output2()?
        .wrap_err("cat could not be got")?;

    Ok(())
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#CC0000"><b>❯</b></font> cargo run
Error:
   0: <font color="#F15D22">cat could not be got</font>
   1: <font color="#F15D22">command exited unsuccessfully</font>

Command:
   "git" "cat"

</pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<pre><code class="language-rust" data-line-numbers="9|13-14" data-noescape="">impl CommandExt for std::process::Command {
    fn output2(&amp;mut self) -&gt; Result&lt;String, eyre::Report&gt; {
        let output = self.output()?;

        let stdout = String::from_utf8_lossy(&amp;output.stdout).into_owned();

        if !output.status.success() {
            let cmd = format!("{:?}", self);
            let stderr = String::from_utf8_lossy(&amp;output.stderr).into_owned();

            Err(eyre!("command exited unsuccessfully"))
                .section(cmd.header("Command:"))
                .section(stdout.header("Stdout:"))
                .section(stderr.header("Stderr:"))
        } else {
            Ok(stdout)
        }
    }
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper"><pre class="term"><font color="#4E9A06"><b>❯</b></font> cargo run
Error:
   0: <font color="#F15D22">cat could not be got</font>
   1: <font color="#F15D22">command exited unsuccessfully</font>

Command:
   "git" "cat"

Stderr:
   git: 'cat' is not a git command. See 'git --help'.

   The most similar commands are
   	clean
   	mktag
   	stage
   	stash
   	tag
   	var</pre>
<aside class="notes"><p>And finally we have an error report including all the context we need
to pinpoint what went wrong.</p>
<p>Hopefully this makes it clear how benefitial it can be to keep errors and context separate.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Libraries</h2>
<ul>
<li>Defining</li>
<li>Propagating</li>
<li>Matching and Reacting</li>
<li>Discarding</li>
<li>Reporting</li>
</ul>
<aside class="notes"><p>Defining =&gt; thiserror, displaydoc, SNAFU
Defining ad-hoc errors + Reporting =&gt; anyhow, eyre
Report Hooks =&gt; color-eyre, color-backtrace, color-anyhow (soon tm)
Propagation =&gt; fehler
Context Capture =&gt; tracing-error, extracterr</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Defining - thiserror</h2>
<pre><code class="language-rust" data-line-numbers="" data-noescape="">#[derive(thiserror::Error, Debug)]
pub enum DataStoreError {
    #[error("data store disconnected")]
    Disconnect(#[from] io::Error),
    #[error("the data for key `{0}` is not available")]
    Redaction(String),
    #[error("invalid header (expected {expected:?}, found {found:?})")]
    InvalidHeader {
        expected: String,
        found: String,
    },
    #[error("unknown data store error")]
    Unknown,
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Defining - displaydoc</h2>
<pre><code class="language-rust" data-line-numbers="" data-noescape="">#[derive(thiserror::Error, Debug, displaydoc::Display)]
pub enum DataStoreError {
    /// data store disconnected
    Disconnect(#[from] io::Error),
    /// the data for key `{0}` is not available
    Redaction(String),
    /// invalid header (expected {expected:?}, found {found:?})
    InvalidHeader {
        expected: String,
        found: String,
    },
    /// unknown data store error
    Unknown,
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Defining - SNAFU</h2>
<pre><code class="language-rust" data-line-numbers="1-13|10-11" data-noescape="">#[derive(Debug, Snafu)]
enum Error {
    #[snafu(display("Unable to read configuration from {}: {}", path.display(), source))]
    ReadConfiguration { source: io::Error, path: PathBuf },
}

fn process_data() -&gt; Result&lt;(), Error&gt; {
    let path = "config.toml";
    let configuration = fs::read_to_string(path)
        // wrap error while capturing `path` as context
        .context(ReadConfiguration { path })?;
    Ok(())
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Defining - anyhow/eyre</h2>
<pre><code class="language-rust" data-line-numbers="1-2|4-6" data-noescape="">// Construct an ad-hoc error
Err(eyre!("file not found"))?

// Constructing an ad-hoc wrapping error
fallible_fn()
    .wrap_err("failed operation")?;
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Common Concerns - Defining</h2>
<ul>
<li>Open Set vs Closed Set</li>
<li>Stack Size</li>
<li>Unreportable Errors</li>
</ul>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Propagating - fehler</h2>
<pre><code class="language-rust" data-noescape="">#[fehler::throws(i32)]
fn foo(x: bool) -&gt; i32 {
    if x {
        0
    } else {
        fehler::throw!(1);
    }
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Gathering Context - tracing-error</h2>
<pre><code class="language-rust" data-line-numbers="2|3|5-7" data-noescape="">let error = std::fs::read_to_string("myfile.txt")
    .in_current_span();
let error: &amp;(dyn std::error::Error + 'static) = &amp;error;

if let Some(spantrace) = error.span_trace() {
    eprintln!("found a spantrace:\n{}", spantrace);
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Gathering Context - extracterr</h2>
<pre><code class="language-rust" data-noescape="">type Error = extracter::Bundled&lt;ExampleError, backtrace::Backtrace&gt;;

fn foo() -&gt; Result&lt;(), Error&gt; {
    Err(ExampleError)?
}
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Matching and Reacting</h2>
<aside class="notes"><p>mostly handled by builtin features, match, downcast.</p>
</aside></div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Matching and Reacting - anyhow/eyre</h2>
<pre><code class="language-rust" data-noescape="">use <a href="https://docs.rs/eyre">eyre</a>::WrapErr;

#[derive(Debug, displaydoc::Display)]
/// Foo error
struct FooError;

let report = fallible_fn()
    .wrap_err(FooError)
    .unwrap_err();

let foo_error = report.downcast_ref::&lt;FooError&gt;().unwrap();
</code></pre>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Discarding</h2>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Reporting</h2>
<ul>
<li>Reporters: anyhow/eyre</li>
<li>Hooks: color-eyre, jane-eyre, color-anyhow (soon), color-backtrace</li>
</ul>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Common Concerns - Reporters</h2>
<ul>
<li>Reporters usually impl <code>From&lt;E: Error&gt;</code></li>
<li>if they do they <em>cannot</em> impl <code>Error</code></li>
<li>Prints report via <code>Debug</code> trait</li>
</ul>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h2>Library vs Application</h2>
<ul>
<li>Library =&gt; error defining libraries</li>
<li>Application =&gt; adhoc error defining + error reporting libraries</li>
</ul>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
<section><div class="slide-wrapper">
<h1>Fin</h1>
</div><div class="slide-footer">
<div class="slide-footer-left">Jane Lusby</div>
<div class="slide-footer-right">
<i class="fa-twitter fab"></i> <a href="https://twitter.com/yaahc_">@yaahc_</a> / <a href="https://yaah.dev/">yaah.dev</a>
</div>
</div></section>
        </div>
    </div>

    <script src="dist/reveal.js"></script>
    <script src="plugin/notes/notes.js"></script>
    <script src="plugin/markdown/markdown.js"></script>
    <script src="plugin/highlight/highlight.js"></script>
    <script src="plugin/highlight/rust.js"></script>
    <script src="plugin/highlight/shell.js"></script>
    <script>
        Reveal.initialize({
            width: 960,
            height: 540,
            hash: true,
            controls: false,
            progress: false,
            showNotes: true,
            transition: 'none',
            /* vertical- */ center: false,
            markdown: {
                smartypants: true,
            },
            plugins: [RevealMarkdown, HighlightRustCompiler, HighlightShellSession, RevealHighlight, RevealNotes]
        });
    </script>


</body></html>
